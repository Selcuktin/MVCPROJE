{% extends 'base.html' %}

{% block title %}Öğretmenler{% endblock %}

{% block extra_css %}
<style>
    .teacher-card {
        transition: all 0.3s ease;
        border: none;
        border-radius: 15px;
        overflow: hidden;
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    }

    .teacher-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .teacher-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
    }

    .teacher-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: rotate(45deg);
    }

    .teacher-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        border: 3px solid rgba(255, 255, 255, 0.3);
        position: relative;
        z-index: 2;
    }

    .teacher-info {
        position: relative;
        z-index: 2;
        text-align: center;
    }

    .teacher-name {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .teacher-department {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
    }

    .teacher-body {
        padding: 1.5rem;
    }

    .info-row {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
        font-size: 0.9rem;
    }

    .info-icon {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
        font-size: 0.8rem;
    }

    .info-icon.email { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .info-icon.phone { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
    .info-icon.date { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
    .info-icon.courses { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; }

    .courses-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
        margin-top: 1rem;
    }

    .course-tag {
        display: inline-block;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        margin: 0.25rem;
        font-weight: 500;
    }

    .status-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 3;
        border-radius: 20px;
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-active { background: #28a745; color: white; }
    .status-inactive { background: #ffc107; color: #212529; }
    .status-retired { background: #17a2b8; color: white; }
    .status-suspended { background: #dc3545; color: white; }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        margin-top: 1rem;
    }

    .btn-action {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .btn-view { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .btn-edit { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
    .btn-delete { background: linear-gradient(135deg, #ff9a9e, #fecfef); color: #dc3545; }

    .btn-action:hover {
        transform: scale(1.1);
        color: white;
    }

    .search-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
    }

    .search-section .form-control,
    .search-section .form-select {
        border: none;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        background: rgba(255, 255, 255, 0.9);
    }

    .search-section .btn {
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        transition: all 0.3s ease;
    }

    .search-section .btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        color: white;
    }

    .page-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
    }

    .page-subtitle {
        color: #6c757d;
        font-size: 1.1rem;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border-radius: 15px;
        border: 2px dashed #dee2e6;
    }

    .empty-icon {
        font-size: 4rem;
        color: #dee2e6;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-chalkboard-teacher me-3"></i>Öğretmenler
        </h1>
        <p class="page-subtitle">Akademik kadromuz ve verilen dersler</p>
        
        {% if user.is_staff or user.userprofile.user_type == 'admin' %}
        <div class="mt-3">
            <a href="{% url 'teachers:create' %}" class="btn btn-primary btn-lg" style="border-radius: 25px; padding: 0.75rem 2rem;">
                <i class="fas fa-plus me-2"></i>Yeni Öğretmen Ekle
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Arama ve Filtreleme -->
    <div class="search-section">
        <div class="row align-items-center">
            <div class="col-12">
                <h4 class="mb-3"><i class="fas fa-search me-2"></i>Arama ve Filtreleme</h4>
                <form method="get" class="row g-3">
                    <div class="col-md-4">
                        <input type="text" name="search" class="form-control" placeholder="Ad, soyad, TC, email ara..."
                            value="{{ request.GET.search }}">
                    </div>
                    <div class="col-md-3">
                        <select name="department" class="form-select">
                            <option value="">Tüm Bölümler</option>
                            <option value="Bilgisayar Mühendisliği" {% if request.GET.department == 'Bilgisayar Mühendisliği' %}selected{% endif %}>Bilgisayar Mühendisliği</option>
                            <option value="Elektrik Mühendisliği" {% if request.GET.department == 'Elektrik Mühendisliği' %}selected{% endif %}>Elektrik Mühendisliği</option>
                            <option value="Makine Mühendisliği" {% if request.GET.department == 'Makine Mühendisliği' %}selected{% endif %}>Makine Mühendisliği</option>
                            <option value="İnşaat Mühendisliği" {% if request.GET.department == 'İnşaat Mühendisliği' %}selected{% endif %}>İnşaat Mühendisliği</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select name="status" class="form-select">
                            <option value="">Tüm Durumlar</option>
                            <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>Aktif</option>
                            <option value="inactive" {% if request.GET.status == 'inactive' %}selected{% endif %}>Pasif</option>
                            <option value="retired" {% if request.GET.status == 'retired' %}selected{% endif %}>Emekli</option>
                            <option value="suspended" {% if request.GET.status == 'suspended' %}selected{% endif %}>Askıda</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn w-100">
                            <i class="fas fa-search me-2"></i>Ara
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Öğretmen Listesi -->
    <div class="row">
        {% for teacher in teachers %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="teacher-card">
                <!-- Teacher Header -->
                <a href="{% url 'teachers:detail' teacher.pk %}" class="teacher-header" style="text-decoration: none; color: inherit; display: block;">
                    <div class="status-badge status-{{ teacher.status }}">
                        {{ teacher.get_status_display }}
                    </div>
                    
                    <div class="teacher-avatar">
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                    
                    <div class="teacher-info">
                        <div class="teacher-name">{{ teacher.full_name }}</div>
                        <div class="teacher-department">{{ teacher.department }}</div>
                        <small style="opacity: 0.8;">{{ teacher.tc_no }}</small>
                    </div>
                </a>

                <!-- Teacher Body -->
                <div class="teacher-body">
                    <!-- Contact Info -->
                    <div class="info-row">
                        <div class="info-icon email">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="flex-grow-1">
                            <small class="text-muted d-block">Email</small>
                            <span>{{ teacher.email|truncatechars:30 }}</span>
                        </div>
                    </div>

                    {% if teacher.phone %}
                    <div class="info-row">
                        <div class="info-icon phone">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="flex-grow-1">
                            <small class="text-muted d-block">Telefon</small>
                            <span>{{ teacher.phone }}</span>
                        </div>
                    </div>
                    {% endif %}

                    {% if teacher.hire_date %}
                    <div class="info-row">
                        <div class="info-icon date">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="flex-grow-1">
                            <small class="text-muted d-block">İşe Başlama</small>
                            <span>{{ teacher.hire_date|date:"d.m.Y" }}</span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Courses Section -->
                    {% if teacher.course_groups.all %}
                    <div class="info-row">
                        <div class="info-icon courses">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="flex-grow-1">
                            <small class="text-muted d-block">Verdiği Dersler</small>
                            <span class="fw-bold">{{ teacher.course_groups.count }} ders</span>
                        </div>
                    </div>

                    <div class="courses-section">
                        <div class="d-flex flex-wrap">
                            {% for group in teacher.course_groups.all|slice:":4" %}
                            <span class="course-tag">{{ group.course.code }}</span>
                            {% endfor %}
                            {% if teacher.course_groups.count > 4 %}
                            <span class="course-tag" style="background: #6c757d;">+{{ teacher.course_groups.count|add:"-4" }}</span>
                            {% endif %}
                        </div>
                    </div>
                    {% else %}
                    <div class="info-row">
                        <div class="info-icon courses">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="flex-grow-1">
                            <small class="text-muted d-block">Verdiği Dersler</small>
                            <span class="text-muted">Henüz ders atanmamış</span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <a href="{% url 'teachers:detail' teacher.pk %}" class="btn-action btn-view" title="Detayları Görüntüle">
                            <i class="fas fa-eye"></i>
                        </a>
                        {% if user.is_staff or user.userprofile.user_type == 'admin' %}
                        <a href="{% url 'teachers:update' teacher.pk %}" class="btn-action btn-edit" title="Düzenle">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'teachers:delete' teacher.pk %}" class="btn-action btn-delete" title="Sil"
                           onclick="return confirm('{{ teacher.full_name }} adlı öğretmeni silmek istediğinizden emin misiniz?')">
                            <i class="fas fa-trash"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <h4 class="text-muted">Öğretmen Bulunamadı</h4>
                <p class="text-muted mb-0">Arama kriterlerinize uygun öğretmen bulunamadı.</p>
                {% if user.is_staff or user.userprofile.user_type == 'admin' %}
                <div class="mt-3">
                    <a href="{% url 'teachers:create' %}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>İlk Öğretmeni Ekle
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="d-flex justify-content-center mt-5">
        <nav aria-label="Sayfa navigasyonu">
            <div class="d-flex align-items-center gap-3">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" 
                   class="btn btn-outline-primary" style="border-radius: 25px; padding: 0.5rem 1.5rem;">
                    <i class="fas fa-chevron-left me-2"></i>Önceki
                </a>
                {% endif %}

                <div class="px-4 py-2 bg-light rounded-pill">
                    <span class="fw-bold text-primary">{{ page_obj.number }}</span>
                    <span class="text-muted"> / {{ page_obj.paginator.num_pages }}</span>
                </div>

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.department %}&department={{ request.GET.department }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" 
                   class="btn btn-outline-primary" style="border-radius: 25px; padding: 0.5rem 1.5rem;">
                    Sonraki<i class="fas fa-chevron-right ms-2"></i>
                </a>
                {% endif %}
            </div>
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Animate cards on load
        const cards = document.querySelectorAll('.teacher-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });

        // Add loading animation to search button
        const searchForm = document.querySelector('.search-section form');
        const searchButton = document.querySelector('.search-section .btn');
        
        if (searchForm && searchButton) {
            searchForm.addEventListener('submit', function() {
                searchButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Aranıyor...';
                searchButton.disabled = true;
            });
        }

        // Add hover effects to course tags
        const courseTags = document.querySelectorAll('.course-tag');
        courseTags.forEach(tag => {
            tag.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
                this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
            });
            
            tag.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = 'none';
            });
        });

        // Add confirmation with better styling for delete buttons
        const deleteButtons = document.querySelectorAll('.btn-delete');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const teacherName = this.getAttribute('title').replace('Sil', '').trim();
                
                if (confirm(`⚠️ DİKKAT!\n\n"${teacherName}" adlı öğretmeni silmek istediğinizden emin misiniz?\n\nBu işlem geri alınamaz ve öğretmenin tüm ders kayıtları da silinecektir.`)) {
                    // Add loading state
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    this.style.pointerEvents = 'none';
                    
                    // Navigate to delete URL
                    window.location.href = this.href;
                }
            });
        });

        // Add smooth scroll to top after pagination
        const paginationLinks = document.querySelectorAll('nav a');
        paginationLinks.forEach(link => {
            link.addEventListener('click', function() {
                // Add loading state
                this.style.opacity = '0.7';
                this.style.pointerEvents = 'none';
            });
        });

        // Add search input enhancements
        const searchInput = document.querySelector('input[name="search"]');
        if (searchInput) {
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const value = this.value;
                
                // Add visual feedback
                if (value.length > 0) {
                    this.style.borderLeft = '4px solid #667eea';
                } else {
                    this.style.borderLeft = 'none';
                }
            });
        }

        // Add status badge animations
        const statusBadges = document.querySelectorAll('.status-badge');
        statusBadges.forEach(badge => {
            badge.style.animation = 'pulse 2s infinite';
        });
    });

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .course-tag {
            transition: all 0.3s ease;
        }
        
        .search-section .form-control:focus,
        .search-section .form-select:focus {
            box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .teacher-card {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}